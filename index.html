<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M-Cyrillic Protocol IDE | Shima Hikari</title>
    <style>
        :root {
            --bg: #0d1117; --text: #c9d1d9; --accent: #58a6ff; --secondary: #8b949e;
            --code-bg: #161b22; --border: #30363d; --success: #238636; --danger: #f85149;
            --warn: #d29922; --info: #a5d6ff; --adj: #ff7b72;
            --halo-glow: 0 0 10px rgba(88, 166, 255, 0.4);
        }
        body { font-family: 'Segoe UI', "Hiragino Kaku Gothic ProN", sans-serif; background-color: var(--bg); color: var(--text); line-height: 1.6; margin: 0; }
        
        .container { max-width: 1200px; margin: 0 auto; padding: 20px; display: grid; grid-template-columns: 240px 1fr; gap: 30px; }
        .sidebar { position: sticky; top: 20px; height: calc(100vh - 40px); border-right: 1px solid var(--border); padding-right: 20px; overflow-y: auto; }
        
        .logo-area { text-align: center; margin-bottom: 30px; border-bottom: 1px solid var(--border); padding-bottom: 20px; }
        .logo-text { font-family: monospace; font-weight: bold; color: var(--accent); text-shadow: var(--halo-glow); font-size: 1.1rem; }
        nav ul { list-style: none; padding: 0; }
        nav a { color: var(--secondary); text-decoration: none; display: block; padding: 8px; font-size: 0.9rem; transition: 0.2s; }
        nav a:hover { color: var(--accent); background: rgba(88,166,255,0.1); border-radius: 4px; }

        .section { margin-bottom: 40px; background: var(--code-bg); padding: 25px; border-radius: 8px; border: 1px solid var(--border); }
        h2 { color: var(--accent); border-bottom: 1px solid var(--border); padding-bottom: 10px; font-family: monospace; }
        h1 { color: var(--accent); font-size: 1.5rem; }
        
        table { width: 100%; border-collapse: collapse; margin: 15px 0; font-size: 0.85rem; }
        th, td { border: 1px solid var(--border); padding: 10px; text-align: left; }
        th { background-color: #21262d; }
        
        .tool-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        textarea, select, input { width: 100%; background: #000; border: 1px solid var(--border); color: #fff; padding: 10px; border-radius: 4px; box-sizing: border-box; margin-bottom: 5px; }
        
        .trans-display { background: #000; border: 1px dashed var(--accent); color: var(--accent); padding: 20px; text-align: center; font-size: 1.8rem; font-family: 'Courier New', monospace; margin-top: 10px; min-height: 40px; }
        button { background: var(--accent); color: #000; border: none; padding: 12px; cursor: pointer; font-weight: bold; width: 100%; border-radius: 4px; transition: 0.2s; margin-top: 5px; }
        button:hover { opacity: 0.9; box-shadow: var(--halo-glow); }
        
        .btn-delete { background: transparent; color: var(--danger); border: 1px solid var(--danger); padding: 2px 8px; width: auto; font-size: 0.7rem; margin-top: 0; }
        .btn-delete:hover { background: var(--danger); color: white; }
        .btn-reset { background: transparent; color: var(--secondary); border: 1px solid var(--secondary); font-size: 0.8rem; }

        .badge { font-size: 0.7rem; padding: 2px 5px; border-radius: 3px; background: #30363d; vertical-align: middle; margin-right: 5px; font-family: monospace; }
        .save-status { font-size: 0.7rem; color: var(--success); text-align: center; margin-top: 5px; }
        
        /* 文法要素の説明用 */
        .grammar-tag { display: inline-block; padding: 2px 6px; border-radius: 4px; font-size: 0.8rem; margin-right: 5px; margin-bottom: 5px; border: 1px solid var(--border); }
    </style>
</head>
<body>

<div class="container">
    <aside class="sidebar">
        <div class="logo-area">
            <div class="logo-text">MILLENNIUM<br>M-CYRILLIC IDE</div>
            <div style="font-size: 0.7rem; color: var(--secondary); margin-top:10px;">PROTOCOL v3.5<br>FULL LOGIC & SAVE</div>
            <div id="save-status" class="save-status">● Auto-Save Active</div>
        </div>
        <nav>
            <p style="font-size: 0.7rem; color: var(--accent);">-- DOCUMENTATION</p>
            <ul>
                <li><a href="#overview">00. 概要 (Overview)</a></li>
                <li><a href="#phonology">01. 音韻論 (Phonology)</a></li>
                <li><a href="#syntax">02. 統語論 (Syntax)</a></li>
                <li><a href="#logic">03. 論理構造 (Logic)</a></li>
            </ul>
            <p style="font-size: 0.7rem; color: var(--accent); margin-top:20px;">-- TERMINAL</p>
            <ul>
                <li><a href="#translator">論理演算ターミナル</a></li>
                <li><a href="#dictionary">辞書 & データ管理</a></li>
            </ul>
        </nav>
    </aside>

    <main class="main-content">
        <section id="overview" class="section">
            <h1>00. 概要定義</h1>
            <p><strong>言語名称：</strong> Metric-Cyrillic (M-Cyrillic / メトリック・キリル)</p>
            <p><strong>開発者：</strong> 島 ヒカリ (Millennium Science School)</p>
            <p>本言語は、スラブ語派のキリル文字を記号として採用し、物理学的な演算子構造（ポーランド記法）を文法に取り入れた人工言語である。</p>
        </section>

        <section id="phonology" class="section">
            <h1>01. 音韻論 (Phonology)</h1>
            <p>音素は物理定数のような硬質感を持つ。</p>
            <h3>母音体系</h3>
            <table>
                <tr><th>文字</th><th>IPA</th><th>物理的意味</th></tr>
                <tr><td>А</td><td>/a/</td><td>開放・エネルギー (慣性格)</td></tr>
                <tr><td>И</td><td>/i/</td><td>指向性・ベクトル (属性/形容)</td></tr>
                <tr><td>У</td><td>/u/</td><td>質量・重力</td></tr>
                <tr><td>Э</td><td>/e/</td><td>定義・等号</td></tr>
                <tr><td>О</td><td>/o/</td><td>空間・包含 (作用格/副詞)</td></tr>
                <tr><td>Ы</td><td>/ɨ/</td><td>虚数・仮定 (If/Else)</td></tr>
            </table>
        </section>

        <section id="syntax" class="section">
            <h1>02. 統語論 (Syntax)</h1>
            <p>VSO（動詞-主語-目的語）を基本とし、接頭辞・接尾辞により論理を修飾する。</p>
            <div style="background:var(--code-bg); padding:10px; border:1px solid var(--border); font-family:monospace;">
                [接続詞] [接頭辞-動詞+時制] [副詞] [主語+格] [形容詞] [目的語+格]
            </div>
        </section>

        <section id="logic" class="section">
            <h1>03. 論理構造 & 拡張文法</h1>
            <p>v3.5にて実装された拡張ロジック定義。</p>
            
            <h3>条件分岐 (If Statement)</h3>
            <p>「もし (If)」が存在する場合、文頭に接続詞 <code class="language-cyrillic">Иф</code> を配置し、動詞の時制を仮定相 <code class="language-cyrillic">-ы</code> に変更する。</p>
            
            <h3>疑問プロトコル (Interrogative)</h3>
            <p>「？ (Question)」を検知した場合、動詞に接頭辞 <code class="language-cyrillic">Ли-</code> を付与し、解の要求（Query）であることを宣言する。</p>

            <h3>修飾構造 (Modifiers)</h3>
            <ul>
                <li><span class="grammar-tag" style="border-color:var(--adj); color:var(--adj)">形容詞</span> 語根に <strong>-и</strong> を付与。変数の性質を定義する。</li>
                <li><span class="grammar-tag" style="border-color:var(--warn); color:var(--warn)">副詞</span> 語根に <strong>-о</strong> を付与。関数の実行速度や精度を定義する。</li>
            </ul>
        </section>

        <section id="translator" class="section" style="border: 1px solid var(--accent);">
            <h2>論理演算ターミナル</h2>
            <textarea id="jp-input" placeholder="例：おはよう。先生、今日はどんな授業？" oninput="autoTranslate()"></textarea>
            <div class="trans-display" id="m-output">// STANDBY</div>
            <div id="log" style="font-size: 0.75rem; color: var(--secondary); margin-top: 10px; font-family: monospace;"></div>
        </section>

        <section id="dictionary" class="section">
            <h2>辞書データベース</h2>
            <div style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;">
                <div style="max-height: 400px; overflow-y: auto;">
                    <table>
                        <thead><tr><th>種別</th><th>語根</th><th>意味</th><th>操作</th></tr></thead>
                        <tbody id="dict-body"></tbody>
                    </table>
                </div>
                <div>
                    <h3>新規データ登録</h3>
                    <select id="new-type">
                        <option value="intj">感嘆詞 (Signal)</option>
                        <option value="aux">助動詞 (Aux)</option>
                        <option value="verb">動詞 (Action)</option>
                        <option value="noun">名詞 (Entity)</option>
                        <option value="adj">形容詞 (Attr)</option>
                        <option value="adv">副詞 (Mod)</option>
                    </select>
                    <input type="text" id="new-root" placeholder="語根">
                    <input type="text" id="new-mean" placeholder="意味">
                    <button onclick="addWord()">登録</button>
                    <h3 style="margin-top:20px;">一括インポート</h3>
                    <textarea id="bulk-input" style="height: 80px;" placeholder="種類：感嘆詞 語根：Оха | 意味：おはよう"></textarea>
                    <button onclick="bulkImport()" style="background:var(--success); color:white;">実行</button>
                </div>
            </div>
        </section>
    </main>
</div>

<script>
    const STORAGE_KEY = 'm_cyrillic_v3_8_data';
    const defaultDict = {
        verbs: [{id:1, root:"Ген", mean:"生成"}, {id:2, root:"Скан", mean:"解析"}, {id:3, root:"Эст", mean:"である"}],
        nouns: [{id:101, root:"Кляйн", mean:"私"}, {id:102, root:"Наблю", mean:"先生"}],
        adjs: [{id:201, root:"Ю", mean:"美しい"}],
        advs: [], conjs: [], 
        intjs: [{id:501, root:"Оха", mean:"おはよう"}, {id:502, root:"Я", mean:"はい"}],
        auxs: [{id:601, root:"Кан", mean:"できる"}, {id:602, root:"Вол", mean:"したい"}]
    };

    let dictionary = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultDict;

    function save() { localStorage.setItem(STORAGE_KEY, JSON.stringify(dictionary)); }

    function refreshUI() {
        const tbody = document.getElementById('dict-body');
        tbody.innerHTML = '';
        // 各カテゴリの定義と色設定
        const categories = [
            { key: 'verbs', label: '動', color: '#d2a8ff' }, // 紫
            { key: 'nouns', label: '名', color: '#7ee787' }, // 緑
            { key: 'adjs', label: '形', color: '#ff7b72' },  // 赤
            { key: 'advs', label: '副', color: '#d29922' },  // 黃
            { key: 'conjs', label: '接', color: '#a5d6ff' }  // 青
            ,{ key: 'auxs', label: '助', color: '#79c0ff' }  // 水
            ,{ key: 'intjs', label: '感', color: '#ffab70' } // 橙
        ];
        categories.forEach(cat => {
            const list = dictionary[cat.key] || [];
            list.forEach(item => {
                tbody.innerHTML += `<tr>
                    <td><span class="badge" style="color:${cat.color}">${cat.label}</span></td>
                    <td style="font-family:monospace; font-weight:bold;">${item.root}</td>
                    <td>${item.mean}</td>
                    <td><button class="btn-delete" onclick="deleteWord('${cat.key}', ${item.id})">削除</button></td>
                </tr>`;
            });
        });
        save(); // 画面更新のたびに保存
    }

    function addWord() {
        const type = document.getElementById('new-type').value + 's';
        const root = document.getElementById('new-root').value.trim();
        const mean = document.getElementById('new-mean').value.trim();
        if(root && mean) { dictionary[type].push({id: Date.now(), root, mean}); refreshUI(); autoTranslate(); }
    }

    function deleteWord(type, id) {
        if(dictionary[type]) {
            dictionary[type] = dictionary[type].filter(item => item.id !== id);
            refreshUI();
            autoTranslate();
        }
    }

    function bulkImport() {
        const text = document.getElementById('bulk-input').value.split('\n');
        text.forEach(line => {
            const r = line.match(/語根[:：]\s*([^\s\|]+)/);
            const m = line.match(/意味[:：]\s*([^\s\n]+)/);
            const t = line.match(/種類[:：]\s*(動詞|名詞|形容詞|副詞|感嘆詞|助動詞)/);
            if(r && m && t) {
                const map = { '動詞':'verbs', '名詞':'nouns', '形容詞':'adjs', '副詞':'advs', '感嘆詞':'intjs', '助動詞':'auxs' };
                dictionary[map[t[1]]].push({id: Date.now() + Math.random(), root: r[1], mean: m[1]});
            }
        });
        refreshUI(); autoTranslate();
    }

    function autoTranslate() {
        const input = document.getElementById('jp-input').value;
        if(!input) { document.getElementById('m-output').innerText = "// STANDBY"; return; }

        let logicLog = [];
        
        // 1. 感嘆詞（Signal）チェック：あれば即出力
        let foundIntj = "";
        (dictionary.intjs || []).forEach(i => { if(input.includes(i.mean)) foundIntj = i.root + "-с"; });
        if(foundIntj) { 
            document.getElementById('m-output').innerText = foundIntj; 
            document.getElementById('log').innerText = "Signal Protocol: 独立定型文";
            return; 
        }

        // 2. 構文要素解析
        let v="", s="", o="", n_of="", aux="", adj_s="", tense="т";

        // 助動詞
        (dictionary.auxs || []).forEach(a => { if(input.includes(a.mean)) aux = a.root + "-"; });
        // 動詞
        (dictionary.verbs || []).forEach(ver => { if(input.includes(ver.mean)) v = ver.root; });
        // 名詞・助詞（格）
        (dictionary.nouns || []).forEach(n => {
            if(input.includes(n.mean + "は") || input.includes(n.mean + "が")) s = n.root + "а";
            if(input.includes(n.mean + "を") || input.includes(n.mean + "に")) o = n.root + "он";
            if(input.includes(n.mean + "の")) n_of = n.root + "е "; // 所有格 -e
        });
        // 形容詞
        (dictionary.adjs || []).forEach(a => { if(input.includes(a.mean)) adj_s = a.root + "и "; });

        // 3. 特殊ルール（AはBだ の対応）
        if(!v && s && (input.includes("だ") || input.includes("です") || adj_s)) v = "Эст";

        // 4. 出力生成（要素が欠けていても可能な限り出す）
        let result = "";
        if(v) result += `${aux}${v}${tense} `;
        if(adj_s) result += adj_s;
        if(n_of) result += n_of;
        if(s) result += s;
        if(o) result += " " + o;

        document.getElementById('m-output').innerText = result.trim() ? result.trim() + "." : "...解析不能";
        document.getElementById('log').innerText = `Elements: V[${v}] S[${s}] O[${o}] Aux[${aux}]`;
    }

    refreshUI();
</script>
</body>
</html>

